---
layout : post
categories : network
title : IP패킷 전달과 포워딩
tags : [network]
date-string : April 16, 2024
---

# IP패킷 전달과 포워딩
## 연결형과 비연결형 서비스
### 연결형 서비스
- 발신지의 네트워크층 프로토콜은 패킷을 보내기 전에 먼저 목적지의 네트워크층 프로토콜과 연결 설정(경로 설정(라우팅)에 의해)
- 연결이 설정되면 발신지에서 목적지로 가는 패킷들은 순서대로 하나씩 보냄
- 모든 패킷은 같은 경로를 통해 전달됨
- 메시지에 속한 모든 패킷이 전달되면 연결 해제됨

### 비연결형 서비스
- 각 패킷은 서로 독립적으로 처리
- 패킷들 사이에 아무런 관계가 없으며 하나의 메시지에 속한 모든 패킷들은 같은 목적지에 전달되더라도 서로 다른 경로로 전달될 수 있다
- IP 프로토콜은 원래 비연결형으로 설계됨

## 직접 전달과 간접 전달
### 패킷 포워딩
- 패킷을 전달하는 방법
- 네트워크 계층은 물리적인 네트워크를 통해 패킷이 처리되는 과정을 감독
- IP 패킷을 발신지에서 최종 목적지까지 전달하는 것으로, 이를 위해 경로를 지정하는 과정 필요
- 패킷을 최종 목적지까지 전달하는 방법
  - 직접 전달
  - 간접 전달

#### 직접 전달
- 최종 목적지가 전달자와 같은 네트워크에 연결되어 있는 호스트
- 패킷의 발신지와 목적지가 같은 네트워크에 위치
- 최종 라우터와 목적지 호스트 사이에 수행
- 목적지 주소에서 netid를 추출한 후 네트워크 주소와 비교하여 같으면 직접 전달 수행
- 송신자는 목적지 IP 주소를 이용하여 목적지 물리 주소를 찾고(ARP 이용) 데이터 링크층으로 보내 패킷을 전달

#### 간접 전달
- 최종 목적지가 같은 네트워크에 있지 않은 호스트
- 최종 목적지 호스트와 같은 네트워크에 연결된 라우터에 도달할 때 까지 여러 라우터를 경유하여 전달
- 목적지 IP주소와 라우팅 테이블을 이용하여 패킷이 전달되어야 하는 다음 라우터의 IP주소를 찾는다

## 포워딩
### 포워딩
- 패킷을 목적지로 가는 경로상에 올려놓는 것을 의미
- 오늘날의 인터넷은 링크의 조합으로 되어 있으므로, 포워딩은 패킷을 다음 홉으로 전달하는 것을 의미
- IP 프로토콜이 원래 비연결형 프로토콜로 설계되었지만, 오늘날 IP는 연결형 프로토콜로 사용되는 경향
- 포워딩의 기법
  - 목적지 주소 기반 포워딩
  - 레이블 기반 포워딩

### 목적지 주소 기반 포워딩
- 전통적인 방법으로 오늘날 주도적으로 사용되고 있음
- 포워딩을 위하여 호스트나 라우터는 라우팅 테이블을 가지고 있어야 한다
- 호스트가 송신할 패킷을 가지고 있거나 라우터가 포워딩 해야 하는 패킷을 수신한 경우, 라우팅 테이블을 참조하여 최종 목적지로 가는 경로를 찾는다
- 단점은 라우팅 테이블이 너무 커져서 라우팅 테이블 내에서 검색이 비효율적임->라우팅 테이블을 줄이는 다양한 방법 모색
- 목적지 주소 기반 포워딩 기술
  - 다음-홉(next-hop)방법
    - 라우팅 테이블을 작게 만드는 기술 중의 하나
    - 전체 경로 정보 대신에 다음 홉 주소만 저장
  - 네트워크-지정(network-specific)방법
    - 라우팅 테이블을 작게, 검색 과정은 간단하게 만드는 방법 중 하나
    - 같은 네트워크에 연결된 모든 호스트 별 엔트리 대신에, 네트워크 주소당 하나의 엔트리 지정
  - 호스트-지정(host-specific)방법
    - 라우팅 테이블에 목적지 주소 저장
    - 네트워크-지정 방법의 반대로 효율성 고려 X
    - 관리자가 직접 네트워크를 제어하고자 할 때 효과적
    - 경로를 점검하거나 보안성을 제공하기 위한 경우에 사용
  - 디폴트(default)방법
    - N2에 연결된 호스트들에 패킷을 보내기 위해서는 라우터 R1이용
    - 나머지 호스트들에 대해서는, 인터넷상의 모든 네트워크를 나열하는 대신에, 네트워크 주소가 0.0.0.0인 디폴트 엔트리만 지정

### 클래스 기반 주소 지정에서 포워딩
- 서브넷팅이 없는 경우의 포워딩
- 서브넷팅이 있는 경우의 포워딩

#### 서브넷팅이 없는 경우의 포워딩
- 각 라우팅 테이블에는 다음과 같이 적어도 세 개의 열이 필요
  - 목적지 네트워크 주소는 목적지 호스트가 어디에 위치하고 있는지 알려준다
  - 다음 홉 주소는 간접 전달의 경우 패킷이 어느 라우터에 전달되어야 하는지 알려준다
  - 인터페이스 번호는 패킷이 나가는 출력 포트를 정의한다

#### 서브넷팅이 있는 경우의 포워딩
- 패킷의 목적지 주소를 추출
- 목적지 주소가 테이블 내의 호스트 지정 주소와 같으면 테이블로쿠터 다음 홉과 인터페이스 번호를 추출
- 목적지 주소와 마스크를 사용하여 서브넷 주소를 추출
- 서브넷 주소를 사용하여 테이블을 탐색하여 다음 홉 주소와 인터페이스 번호를 찾는다. 부합되는 엔트리가 없으면 디폴트가 사용됨
- 다음 홉 주소와 인터페이스 번호가 ARP에 전달됨

### 클래스 없는 주소 지정에서 포워딩
- 클래스 없는 주소지정에서 전체 주소 공간은 한 개의 개체(클래스 X)이다
- 포워딩은 각 블록 별로 한 줄의 정보를 필요로 한다는 것을 의미
- 테이블은 네트워크 주소(블록의 첫번째 주소)에 기반하여 탐색되어야 한다
- 테이블에 마스크(/n)를 포함하여야 한다
- 테이블은 적어도 네개의 열이 필요
